/*This SQL code has been written for a MySQL server*/

/*Student Account; Front-end programmers will handle password checking*/
CREATE TABLE STDACC(
 STDNO		VARCHAR(9) NOT NULL,
 PASSWORD 	VARCHAR(24) NOT NULL,
 CONSTRAINT STDACC_PRIMARY_KEY PRIMARY KEY (STDNO));
 
/*Day lookup table*/
CREATE TABLE DAYS(
  ID		INTEGER(1) NOT NULL,
  DAYNAME	VARCHAR(9) NOT NULL,
  CONSTRAINT DAY_PRIMARY_KEY PRIMARY KEY (ID));

/*Student Events*/
CREATE TABLE STDEVENTS(
 EVENTID	INT NOT NULL AUTO_INCREMENT,
 STDNO		VARCHAR(9) NOT NULL,
 EVENTDESC	VARCHAR(30) NOT NULL,
 STARTTIME	TIME NOT NULL,
 ENDTIME	TIME NOT NULL,
 EVENTDAY	DATE NOT NULL,
 CONSTRAINT STDEVENTS_PRIMARY_KEY PRIMARY KEY (EVENTID),
 CONSTRAINT STDEVENTS_FOREIGN_KEY FOREIGN KEY (STDNO) REFERENCES STDACC (STDNO),
 CONSTRAINT EVENTID_ZERO_CHECK CHECK (EVENTID > 0));
 
/*Staff*/
CREATE TABLE STAFF(
 STAFFID	INT NOT NULL AUTO_INCREMENT,
 NAME		VARCHAR(50) NOT NULL,
 EMAIL		VARCHAR(50),
 OFFICENO	VARCHAR(4),
 OFFICEHRS	VARCHAR(15),
 PHONE		VARCHAR(11),
 CONSTRAINT STAFF_PRIMARY_KEY PRIMARY KEY (STAFFID),
 CONSTRAINT STAFFID_ZERO_CHECK CHECK (STAFFID > 0));

/*Modules*/
CREATE TABLE MODULES(
 MDLCODE	VARCHAR(6) NOT NULL,
 MDLTITLE	VARCHAR(30) NOT NULL,
 MDLLDR		INT NOT NULL,
 CONSTRAINT MODULES_PRIMARY_KEY PRIMARY KEY (MDLCODE),
 CONSTRAINT MODULES_FOREIGN_KEY FOREIGN KEY (MDLLDR) REFERENCES STAFF (STAFFID));
 
/*Table that assigns tutors to modules*/
CREATE TABLE TUTORS(
 STAFFID	INT NOT NULL,
 MDLCODE	VARCHAR(6) NOT NULL,
 CONSTRAINT TUTORS_PRIMARY_KEY PRIMARY KEY (STAFFID, MDLCODE),
 CONSTRAINT TUTORS_FOREIGN_KEY1 FOREIGN KEY (STAFFID) REFERENCES STAFF (STAFFID),
 CONSTRAINT TUTORS_FOREIGN_KEY2 FOREIGN KEY (MDLCODE) REFERENCES MODULES (MDLCODE));
 
/*Module Assessments*/
CREATE TABLE ASSESSMENTS(
 ASSESSID	INT NOT NULL AUTO_INCREMENT,
 MDLCODE	VARCHAR(6) NOT NULL,
 ASSESSDESC	VARCHAR(30) NOT NULL,
 DEADLINE	DATETIME NOT NULL,
 CONSTRAINT ASSESSMENTS_PRIMARY_KEY PRIMARY KEY (ASSESSID),
 CONSTRAINT ASSESSMENTS_FOREIGN_KEY FOREIGN KEY (MDLCODE) REFERENCES MODULES (MDLCODE),
 CONSTRAINT ASSESSID_ZERO_CHECK CHECK (ASSESSID > 0));
 
/*Session type lookup table*/
CREATE TABLE SESSIONTYPE(
 ID			INTEGER(1) NOT NULL,
 STYPE		VARCHAR(15) NOT NULL,
 CONSTRAINT SESSIONTYPE_PRIMARY_KEY PRIMARY KEY (ID));
 
/*Teaching sessions. This includes tutorials. Students' preferred tutorial is selected
from this table through the Enrolment table.*/
CREATE TABLE SESSIONS(
 SESSIONID	INT NOT NULL AUTO_INCREMENT,
 MDLCODE	VARCHAR(6) NOT NULL,
 STYPEID	INTEGER(1) NOT NULL,
 ROOM		VARCHAR(5) NOT NULL,
 DAYID		INTEGER(1) NOT NULL,
 BEGINTIME	TIME NOT NULL,
 ENDTIME	TIME NOT NULL,
 CONSTRAINT SESSIONS_PRIMARY_KEY PRIMARY KEY (SESSIONID),
 CONSTRAINT SESSIONS_FOREIGN_KEY1 FOREIGN KEY (MDLCODE) REFERENCES MODULES (MDLCODE),
 CONSTRAINT SESSIONS_FOREIGN_KEY2 FOREIGN KEY (STYPEID) REFERENCES SESSIONTYPE (ID),
 CONSTRAINT SESSIONS_FOREIGN_KEY3 FOREIGN KEY (DAYID) REFERENCES DAYS (ID),
 CONSTRAINT SESSIONID_ZERO_CHECK CHECK (SESSIONID > 0));
 
/*Enrolment table that links students to their preferred tutorials and to their modules*/
CREATE TABLE ENROLMENT(
 STDNO		VARCHAR(9) NOT NULL,
 MDLCODE	VARCHAR(6) NOT NULL,
 TUTSLOT	INT NOT NULL,
 CONSTRAINT ENROLMENT_PRIMARY_KEY PRIMARY KEY (STDNO, MDLCODE),
 CONSTRAINT ENROLMENT_FOREIGN_KEY1 FOREIGN KEY (STDNO) REFERENCES STDACC (STDNO),
 CONSTRAINT ENROLMENT_FOREIGN_KEY2 FOREIGN KEY (MDLCODE) REFERENCES MODULES (MDLCODE),
 CONSTRAINT ENROLMENT_FOREIGN_KEY3 FOREIGN KEY (TUTSLOT) REFERENCES SESSIONS (SESSIONID));
/*A check is necessary to make sure the data in TUTSLOT points to a session of tutorial Type.
This should be taken care of by the app designer.*/

INSERT INTO STDACC VALUES 
 ('123123456', 'xc8rxc8r'), 
 ('121212121', 'spiderman');

INSERT INTO DAYS VALUES 
 (1, 'Monday'), 
 (2, 'Tuesday'), 
 (3, 'Wednesday'), 
 (4, 'Thursday'), 
 (5, 'Friday'), 
 (6, 'Saturday'), 
 (7, 'Sunday');

INSERT INTO STDEVENTS (STDNO, EVENTDESC, STARTTIME, ENDTIME, EVENTDAY) VALUES 
 ('123123456', 'Pub - Standing Order', '19:00', '23:00', '2016-10-23'),
 ('123123456', 'Sunday lunch', '12:00', '14:00', '2016-11-29'),
 ('121212121', 'Gym', '12:00', '14:00', '2016-11-13'),
 ('121212121', 'Team Meeting', '13:00', '15:00', '2016-11-12');
 
INSERT INTO STAFF (NAME, EMAIL, OFFICENO, OFFICEHRS, PHONE) VALUES
 ('Dave Voorhis', 'd.voorhis@derby.ac.uk', 'B208', 'Thu 13-17', '1410'),
 ('Chris Windmill', 'c.windmill@derby.ac.uk', 'E516', 'Fri 12-16', '9216'),
 ('Amanda Whitbrook', 'a.whitbrook@derby.ac.uk', 'E516', 'Tue 13-17', '9989'),
 ('Wayne Rippin', 'w.rippin@derby.ac.uk', 'E516', 'Fri 12-16', '8989'),
 ('Nige', 'n.jones@derby.ac.uk', 'N404', NULL, NULL),
 ('Casey', 'c.zog@derby.ac.uk', NULL, NULL, NULL),
 ('Jack', NULL, 'N210', NULL, NULL),
 ('Farhan', NULL, 'E512', NULL, NULL),
 ('Andy', 'a.zhang@derby.ac.uk', NULL, NULL, NULL);

INSERT INTO MODULES VALUES
 ('5CC507', 'Databases', 1),
 ('5CC518', 'Team Project', 1),
 ('5CC516', 'Software Engineering', 2),
 ('4CC510', 'Programming I', 3),
 ('4CC511', 'Programming II', 4);
 
INSERT INTO SESSIONTYPE VALUES
 (1, 'Lecture'),
 (2, 'Seminar'),
 (3, 'Tutorial'),
 (4, 'Lab');

/*SESSIONS table contains tutorials too, so the tutorials from the example data have been added as well*/
INSERT INTO SESSIONS (MDLCODE, STYPEID, ROOM, DAYID, BEGINTIME, ENDTIME) VALUES
 ('5CC507', 1, 'B301', 2, '18:00', '19:00'),
 ('5CC507', 3, 'B204', 1, '9:00', '10:00'),
 ('5CC507', 3, 'B204', 1, '11:00', '12:00'),
 ('5CC507', 3, 'B203', 1, '13:00', '14:00'),
 ('5CC507', 3, 'B204a', 2, '10:00', '11:00'),
 ('5CC507', 3, 'B205', 2, '11:00', '12:00'),
 ('5CC507', 3, 'B212', 4, '13:00', '14:00'),
 ('5CC518', 1, 'T204', 1, '13:00', '14:00'),
 ('5CC518', 3, 'B203', 1, '9:00', '10:00'),
 ('5CC518', 3, 'B212', 1, '11:00', '12:00'),
 ('5CC518', 3, 'B203', 1, '13:00', '14:00'),
 ('5CC518', 3, 'B204a', 2, '10:00', '11:00'),
 ('5CC518', 3, 'B205', 2, '11:00', '12:00'),
 ('5CC518', 3, 'B212', 4, '13:00', '14:00'),
 ('5CC518', 3, 'N416', 5, '10:00', '11:00'),
 ('5CC516', 1, 'N110', 4, '12:00', '13:00'),
 ('5CC516', 3, 'B212', 3, '11:00', '12:00'),
 ('5CC516', 3, 'B202', 4, '11:00', '12:00'),
 ('4CC510', 1, 'OL1', 1, '16:00', '17:00'),
 ('4CC510', 3, 'B204', 2, '9:00', '17:00'),
 ('4CC510', 3, 'B204a', 2, '9:00', '17:00'),
 ('4CC511', 1, 'B301', 2, '18:00', '19:00'),
 ('4CC511', 3, 'B204', 1, '9:00', '10:00'),
 ('4CC511', 3, 'B204', 1, '11:00', '12:00'),
 ('4CC511', 3, 'B203', 1, '13:00', '14:00'),
 ('4CC511', 3, 'B204a', 2, '10:00', '11:00'),
 ('4CC511', 3, 'B205', 2, '11:00', '12:00'),
 ('4CC511', 3, 'B212', 4, '13:00', '14:00');
 
INSERT INTO TUTORS VALUES
 (5, '5CC507'),
 (8, '5CC507'),
 (6, '5CC518'),
 (8, '5CC518'),
 (7, '5CC516'),
 (1, '4CC511'),
 (9, '4CC511');
 
INSERT INTO ASSESSMENTS (MDLCODE, ASSESSDESC, DEADLINE) VALUES
 ('5CC507', 'Milestone 1', '2016-10-5 17:00'),
 ('5CC507', 'Milestone 2', '2016-11-5 17:00'),
 ('5CC507', 'Project hand-in', '2016-12-11 23:59'),
 ('5CC518', 'Performance review', '2016-12-11 23:59'),
 ('5CC516', 'Portfolio hand-in', '2016-12-11 23:59'),
 ('4CC510', 'Portfolio hand-in', '2016-12-11 17:00'),
 ('4CC511', 'Project hand-in', '2016-10-17 23:59'),
 ('4CC511', 'Quiz', '2016-12-11 12:00');
 
INSERT INTO ENROLMENT VALUES
 ('123123456', '5CC507', 4),
 ('123123456', '5CC518', 9),
 ('123123456', '5CC516', 18),
 ('123123456', '4CC510', 20),
 ('121212121', '5CC518', 14),
 ('121212121', '5CC516', 18);
 

